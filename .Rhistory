setwd("C:/Users/caios/OneDrive/Documentos/GitHub/mqagp/")
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico_MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
df.pessoa <- read_excel("Domicilio02_MG.xls")
df <- merge(df.basico,df.pessoa)
rm(df.pessoa,df.basico)
# setor censitário escolhido
tab01a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop = sum(V001))
library(knitr)
library(kableExtra)
tab01a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop = sum(V001))
library(tidyselect)
df <- df %>% mutate(
Cod_setor= as.character(Cod_setor),
Situacao_setor_agreg = case_when(Situacao_setor==1 | Situacao_setor==2 |
Situacao_setor==3   ~ "Urbano",
Situacao_setor==4 | Situacao_setor==5 |
Situacao_setor==6 | Situacao_setor==7 |
Situacao_setor==8 ~ "Rural")
)
library(knitr)
library(kableExtra)
# setor censitário escolhido
tab01a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop = sum(V001))
setor_escolhido <- 310620005680043
library(knitr)
library(kableExtra)
# setor censitário escolhido
tab01a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop = sum(V001))
tab01a %>% kbl() %>% kable_minimal()
# bairro escolhido
bairro_escolhido <- df$Nome_do_bairro[df$Cod_setor==setor_escolhido]
tab01b <- df %>%
filter(Nome_do_bairro == bairro_escolhido) %>%
summarise(t.pop = sum(V001))
tab01b %>% kbl() %>% kable_minimal()
# Minas Gerais
tab01c <- df %>% summarise(t.pop = sum(V001))
tab01c %>% kbl() %>% kable_minimal()
# Municípios de Minas Gerais
tab01d<- df %>% group_by(Nome_do_municipio) %>%
summarise(t.pop = sum(V001)) %>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab01d %>% slice(1:10) %>% kbl() %>% kable_minimal()
# Subdistritos de Belo Horizonte
tab01e<- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_subdistrito) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab01e %>% slice(1:10) %>% kbl() %>% kable_minimal()
# Bairros de Belo Horizonte
tab01f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,2))
tab01f %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab01a
View(tab01a)
View(tab01b)
View(tab01c)
View(tab01d)
View(tab01e)
View(tab01f)
# setor censitário escolhido
tab02a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))
tab02a %>% kbl() %>% kable_minimal()
# bairro escolhido
bairro_escolhido <- df$Nome_do_bairro[df$Cod_setor==setor_escolhido]
tab02b <- df %>%
filter(Nome_do_bairro == bairro_escolhido) %>%
group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))
tab02b %>% kbl() %>% kable_minimal()
# Minas Gerais
tab02c <- df %>% group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001)) %>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02c %>% kbl() %>% kable_minimal()
# Municípios de Minas Gerais
tab02d<- df %>% group_by(Nome_do_municipio,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02d %>% slice(1:10) %>% kbl() %>% kable_minimal()
# Subdistritos de Belo Horizonte
tab02e<- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_subdistrito,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02e %>% slice(1:10) %>% kbl() %>% kable_minimal()
# Bairros de Belo Horizonte
tab02f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,2))
tab02f %>% slice(1:10) %>% kbl() %>% kable_minimal()
# setor censitário escolhido
tab03a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m)
tab03a %>% kbl() %>% kable_minimal()
# bairro escolhido
bairro_escolhido <- df$Nome_do_bairro[df$Cod_setor==setor_escolhido]
tab03b <- df %>%
filter(Nome_do_bairro == bairro_escolhido) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m)
tab03b %>% kbl() %>% kable_minimal()
# Minas Gerais
tab03c <- df %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m)
tab03c %>% kbl() %>% kable_minimal()
# Municípios de Minas Gerais
tab03d<- df %>% group_by(Nome_do_municipio) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m) %>% arrange(r.sexo)
tab03d %>% kbl() %>% kable_minimal()
# Subdistritos de Belo Horizonte
tab03e<- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_subdistrito) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m) %>% arrange(r.sexo)
tab03e %>% slice(1:10) %>% kbl() %>% kable_minimal()
# Bairros de Belo Horizonte
tab04f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m) %>% arrange(desc(r.sexo))
tab04f %>% slice(1:10) %>% kbl() %>% kable_minimal()
View(tab04f)
View(tab03e)
View(tab03d)
View(tab03c)
View(tab03b)
View(tab03a)
View(tab02f)
View(tab03a)
View(tab03b)
View(tab03c)
View(tab03d)
View(tab03e)
View(tab04f)
View(tab04f)
View(tab03e)
View(tab03d)
View(tab03c)
View(tab03b)
View(tab03a)
tab02f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,2))
tab02f %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab01a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop = sum(V001))
tab01a %>% kbl() %>% kable_minimal()
bairro_escolhido <- df$Nome_do_bairro[df$Cod_setor==setor_escolhido]
tab01b <- df %>%
filter(Nome_do_bairro == bairro_escolhido) %>%
summarise(t.pop = sum(V001))
tab01b %>% kbl() %>% kable_minimal()
tab01c <- df %>% summarise(t.pop = sum(V001))
tab01c %>% kbl() %>% kable_minimal()
tab01d<- df %>% group_by(Nome_do_municipio) %>%
summarise(t.pop = sum(V001)) %>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab01d %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab01d %>% kbl() %>% kable_minimal()
tab01e<- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_subdistrito) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab01e %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab01f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,2))
tab01f %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab02a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))
tab02a %>% kbl() %>% kable_minimal()
bairro_escolhido <- df$Nome_do_bairro[df$Cod_setor==setor_escolhido]
tab02b <- df %>%
filter(Nome_do_bairro == bairro_escolhido) %>%
group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))
tab02b %>% kbl() %>% kable_minimal()
tab02c <- df %>% group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001)) %>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02c %>% kbl() %>% kable_minimal()
tab02c <- df %>% group_by(Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001)) %>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02c %>% kbl() %>% kable_minimal()
tab02d<- df %>% group_by(Nome_do_municipio,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02d %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab02d %>% kbl() %>% kable_minimal()
tab02d %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab02d %>% head(10) %>% kbl() %>% kable_minimal()
tab02d %>% head(16) %>% kbl() %>% kable_minimal()
tab02d<- df %>% group_by(Nome_do_municipio,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02d %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab02d %>% head(14) %>% kbl() %>% kable_minimal()
tab02e<- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_subdistrito,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,1))
tab02e %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab02f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro,Situacao_setor_agreg) %>%
summarise(t.pop = sum(V001))%>%
arrange(desc(t.pop)) %>%
mutate(p.pop = round(t.pop/sum(t.pop)*100,2))
tab02f %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab03a <- df %>%
filter(Cod_setor == setor_escolhido) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m)
tab03a %>% kbl() %>% kable_minimal()
bairro_escolhido <- df$Nome_do_bairro[df$Cod_setor==setor_escolhido]
tab03b <- df %>%
filter(Nome_do_bairro == bairro_escolhido) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m)
tab03b %>% kbl() %>% kable_minimal()
tab03c <- df %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m)
tab03c %>% kbl() %>% kable_minimal()
tab03d<- df %>% group_by(Nome_do_municipio) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m) %>% arrange(r.sexo)
tab03d %>% kbl() %>% kable_minimal()
tab03d %>% slice (1:10) %>% kbl() %>% kable_minimal()
tab03e<- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_subdistrito) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m) %>% arrange(r.sexo)
tab03e %>% slice(1:10) %>% kbl() %>% kable_minimal()
tab03f <- df %>%
filter(Nome_do_municipio == "BELO HORIZONTE") %>%
group_by(Nome_do_bairro) %>%
summarise(t.pop_h = sum(V045),
t.pop_m = sum(V089),
p.pop_h = round(sum(V045)/(t.pop_h+t.pop_m)*100,1),
p.pop_m = round(sum(V089)/(t.pop_h+t.pop_m)*100,1),
r.sexo = t.pop_h/t.pop_m) %>% arrange(desc(r.sexo))
tab03f %>% slice(1:10) %>% kbl() %>% kable_minimal()
df <- popPyramid::popPER
install.packages("popPyramid")
df <- popPyramid::popPER
df <- dplyr::filter(df, Year==2021)
library(popPyramid)
plotPyramid(df=df, age="gAge", sex="Sex", pop="Population")
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
df.pessoa11 <- read_excel("Pessoa11_MG.xls")
df.pessoa12 <- read_excel("Pessoa12_MG.xls")
df <- merge(df.basico,df.pessoa11) %>% merge(.,pessoa12)
df <- merge(df.basico,df.pessoa11) %>% merge(.,df.pessoa12)
rm(df.pessoa11,df.pessoa12,df.basico)
View(df)
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
df.pessoa11 <- read_excel("Pessoa11_MG.xls")
df.pessoa12 <- read_excel("Pessoa12_MG.xls")
df <- merge(df.basico,df.pessoa11)
df <- merge(df.basico,df.pessoa11) %>% merge(.,df.pessoa12)
df <- full_join(df.basico,df.pessoa11) %>% full_join(df.pessoa12)
df.h <- full_join(df.basico,df.pessoa11)
df.m <- full_join(df.basico,df.pessoa12)
rm(df.pessoa11,df.pessoa12,df.basico)
rm(df)
knitr::opts_chunk$set(echo = TRUE)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito")
df.pessoa11 <- read_excel("Pessoa11_MG.xls")
rep("numeric",134)
library(readxl)
library(tidyverse)
df.basico <- read_excel("Basico-MG.xls") %>% select("Cod_setor","Cod_municipio","Nome_do_municipio","Cod_bairro","Nome_do_bairro","Cod_subdistrito","Nome_do_subdistrito") %>% mutate(Cod_setor=as.character(Cod_setor))
df.pessoa11 <- read_excel("Pessoa11_MG.xls",
col_types = c("text", "text", rep("numeric",134)))
df.pessoa12 <- read_excel("Pessoa12_MG.xls",
col_types = c("text", "text", rep("numeric",134)))
df.h <- full_join(df.basico,df.pessoa11)
df.m <- full_join(df.basico,df.pessoa12)
rm(df.pessoa11,df.pessoa12,df.basico)
knitr::opts_chunk$set(echo = TRUE)
library(remotes)
if (!require("microdatasus")){
install.packages("remotes")
remotes::install_github("rfsaldanha/microdatasus")
library(microdatasus)
}
dados_sim <- fetch_datasus(year_start = 2000,
year_end = 2021,
uf = "DF",
information_system = "SIM-DO",
vars=c("DTOBITO","DTNASC","IDADE","SEXO","CODMUNRES"))
dados_sim <- process_sim(dados_sim)
library(tidyverse)
dados_sim<- dados_sim %>% mutate(
obt = 1,
ano = as.numeric(substr(DTOBITO,1,4)),
ano_nasc = as.numeric(substr(DTNASC,1,4)),
IDADEanos = as.numeric(IDADEanos),
faixa_idade =  cut(IDADEanos,c(-Inf,0,4,9,14,19,24,29,34,39,
44,49,54,59,64,69,74,79,84,Inf),
labels = c("_menor que 1 ano",
"01 a 04 anos",
"05 a 09 anos",
"10 a 14 anos",
"15 a 19 anos",
"20 a 24 anos",
"25 a 29 anos",
"30 a 34 anos",
"35 a 39 anos",
"40 a 44 anos",
"45 a 49 anos",
"50 a 54 anos",
"55 a 59 anos",
"60 a 64 anos",
"65 a 69 anos",
"70 a 74 anos",
"75 a 79 anos",
"80 a 84 anos",
"85 anos ou mais")))
# total de óbitos para DF
aggregate(data=dados_sim,obt~ano, FUN= sum) # problema identificado com criação de NA em 2000
# correção dos NA presente na dados_sim de 2000
dados_sim$ano[which(is.na(dados_sim$ano))]<-2000
# total de óbitos para DF
aggregate(data=dados_sim,obt~ano, FUN= sum) # ok com http://tabnet.datasus.gov.br/cgi/tabcgi.exe?sim/cnv/obt10df.def
# tabela 1 - total de obitos e por sexo
tab1 <-dados_sim  %>%
group_by(ano) %>%
summarise(obt = n())
tab1
tab1a<-dados_sim  %>%
filter(SEXO=="Masculino")%>%
group_by(ano) %>%
summarise(obt_masc = n())
tabela1<-merge(tab1,tab1a,by="ano")
rm(tab1,tab1a)
tabela1
tab1b<-dados_sim  %>%
filter(SEXO=="Feminino")%>%
group_by(ano) %>%
summarise(obt_fem = n())
tabela1<-merge(tabela1,tab1b,by="ano")
rm(tab1b)
tabela1
# ajuste com NA
tabela1$obt_masc_ajust<-round(tabela1$obt_masc/(tabela1$obt_masc+tabela1$obt_fem)*tabela1$obt)
tabela1$obt_fem_ajust<-round(tabela1$obt_fem/(tabela1$obt_masc+tabela1$obt_fem)*tabela1$obt)
# verifica se a soma é verdadeira
tabela1$obt_fem_ajust+tabela1$obt_masc_ajust==tabela1$obt
tabela1
library(writexl)
write_xlsx(tabela1,"Tabela  1a - Total de obitos.xlsx")
# produzir gráfico
tabela1<-ts(tabela1,start = 2000,frequency = 1)
library(zoo)
tabela1m<-rollmean(x = tabela1,k = 3)
tabela1m
write_xlsx(as.data.frame(tabela1m),"Tabela  1b - Total de obitos com ma.xlsx")
ggplot(as.data.frame(tabela1m), aes(x=ano, y=obt)) +
geom_line( color="steelblue") +
geom_point() +
xlab("Ano")+
ylab("Óbitos")+
ggtitle("Total de obitos - DF - 2000-2020 ")
